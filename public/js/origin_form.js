function changeDoc(){origin.changed=!0,initializeMandatoryFields(),removeMandatoryHighlight(mandatory_fields),enableSaveButton()}function initializeMandatoryFields(){mandatory_fields=getMandatoryFields(),highlightMandatoryFields(mandatory_fields)}function getMandatoryFields(){var t=[];return $form_elements=$("form").find("input, select, textarea"),$.each($form_elements,function(e,a){"yes"==$(this).data("mandatory")&&t.push($(a)[0])}),t}function highlightMandatoryFields(t){t||(t=getMandatoryFields()),$.each(t,function(t,e){""==$.trim($(this).val())&&($(e).closest(".table_record")||$(e).closest(".form-group").addClass("has-error"),$(e).addClass("error"))})}function removeMandatoryHighlight(t){t||(t=getMandatoryFields()),$.each(t,function(){$parent_div=$(this).closest(".form-group"),$.trim($(this).val())?($(this).closest(".table_record")||$($parent_div).removeClass("has-error"),$(this).removeClass("error")):($(this).closest(".table_record")||$($parent_div).addClass("has-error"),$(this).addClass("error"))})}function makeFieldsReadable(){$form_elements=$("form").find("input, select, textarea"),$.each($form_elements,function(t,e){var a=$(e).attr("type");if(!["hidden","file"].contains(a)){var i="";if("checkbox"==a)i=$(e).is(":checked")?'<i class="fa fa-check-square-o"></i>':'<i class="fa fa-square-o"></i>';else{var n=$(e).val();"is_active"==$(e).attr("name")&&(n=parseInt(n)?"Yes":"No"),n=n||"",i='<p class="form-control-static origin-static">'+n+"</p>"}$(i).insertBefore($(e))}"file"==$(e).attr("type")&&$(e).closest(".btn").remove(),$(e).remove()}),$.each($("table"),function(t,e){$(e).find("th.remove").remove(),$(e).find(".remove-row").closest("td").remove(),$(e).find(".new-row").closest("tr").remove()})}function enableSaveButton(){form_changed=!0,$("#save_form").removeClass("disabled"),$("#save_form").prop("disabled",!1),$("#form-stats > i").removeClass("text-success").addClass("text-warning"),$("#form-status").html("Not Saved")}function showImagePreview(t){if(t.files&&t.files[0]){var e=new FileReader;e.onload=function(e){var a='<img src="'+e.target.result+'">';$(t).closest(".media").find(".avatar-box").empty().append(a)},e.readAsDataURL(t.files[0])}}function setDocData(){void 0!==origin.data&&origin.data&&($.each(origin.data,function(t,e){$.each(e,function(a,i){if("string"==typeof i||"number"==typeof i){var n=$("form#"+origin.slug).find('[name="'+a+'"]');$(n).length&&"file"!=$(n).attr("type")&&("string"==typeof i&&(i.isDate()||i.isDateTime())&&($(n).attr("data-field-value",i),i=i.isDateTime()?moment(i).format("DD-MM-YYYY hh:mm A"):moment(i).format("DD-MM-YYYY")),$(n).val(i))}else if("object"==typeof i&&i)return addNewRows(t,e),!1})}),$("form#"+origin.slug).find(".text-editor, .text-editor-advanced").each(function(t,e){$(e).trumbowyg("html",$(e).val())}),origin.permissions.update||($("body").find(".text-editor, .text-editor-advanced").trumbowyg("disable"),$("body").find(".text-editor, .text-editor-advanced").remove()))}function addNewRow(t,e,a){var i=($(t).find("thead"),$(t).find("tbody"));$(i).find("tr").hasClass("odd")&&$(i).empty(),addRow(t,e||$(i).find("tr").length+1,a)}function addRow(t,e,a){var i=$(t).data("table"),n=$(t).find("thead"),o=$(t).find("tbody"),d=a||"create",l=[],s='<tr class="table_record">';$.each($(n).find("tr > th"),function(t,a){if($(a).hasClass("sr-no")&&0==t)s+='<td class="text-center" style="vertical-align: middle;"></td>';else if($(a).hasClass("remove"))s+='<td class="text-center" data-idx="'+e+'">\t\t\t\t<button type="button" class="btn btn-danger btn-xs remove-row">\t\t\t\t\t<i class="fa fa-times"></i>\t\t\t\t</button>\t\t\t</td>';else if($(a).hasClass("action"))s+='<td class="action" style="display: none;">\t\t\t\t<input type="text" class="form-control input-sm" name="'+i+"["+(e-1)+'][action]" value="'+d+'">\t\t\t</td>',$(this).find('input[name="'+i+"["+(e-1)+'][action]"]').val(d);else if($(a).hasClass("row-id"))s+='<td class="row-id" style="display: none;">\t\t\t\t<input type="text" class="form-control input-sm" name="'+i+"["+(e-1)+'][id]">\t\t\t</td>';else{var n=$(a).data("field-type"),o=$(a).data("field-name"),r=$(a).data("ac-module"),c=$(a).data("ac-field"),f="yes"==$(a).data("readonly")?"readonly":"",m="yes"==$(a).data("hidden")?"style='display: none;'":"";l.push(n),"link"==n?s+='<td data-field-type="link">\t\t\t\t\t<input type="text" class="form-control input-sm autocomplete" \t\t\t\t\tname="'+i+"["+(e-1)+"]["+o+']" \t\t\t\t\tautocomplete="off" data-ac-module="'+r+'" data-ac-field="'+c+'"'+f+">\t\t\t\t</td>":"image"==n?s+='<td data-field-type="image">\t\t\t\t\t<div class="col-md-12 media">\t\t\t\t\t\t<div class="pull-left text-center avatar-box">\t\t\t\t\t\t\t<i class="fa fa-picture-o inline fa-2x avatar"></i>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="media-body text-left">\t\t\t\t\t\t\t<label title="Upload image file" class="btn btn-primary btn-xs">\t\t\t\t\t\t\t\t<input type="file" accept="image/*" name="'+i+"["+(e-1)+"]["+o+']" class="hide">\t\t\t\t\t\t\t\tChange\t\t\t\t\t\t\t</label>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</td>':"select"==n?(s+='<td data-field-type="select">\t\t\t\t\t<select class="form-control input-sm" name="'+i+"["+(e-1)+"]["+o+']">',$.each($(a).data("options").split(","),function(t,e){if(e=trim(e),e=e.split(":"),2==e.length)var a=e[1],i=e[0];else var a=e[0],i=e[0];s+='<option value="'+a+'">'+i+"</option>"}),s+="</select></td>"):"checkbox"==n?s+='<td data-field-type="checkbox"'+m+' class="text-center" style="vertical-align: middle;">\t\t\t\t\t<input type="hidden" class="checkbox-value" name="'+i+"["+(e-1)+"]["+o+']" value="0">\t\t\t\t\t<input type="checkbox" name="'+i+"["+(e-1)+"]["+o+']" '+f+">\t\t\t\t</td>":"date"==n?s+='<td data-field-type="date">\t\t\t\t\t<div class="input-group date">\t\t\t\t\t\t<span class="input-group-addon">\t\t\t\t\t\t\t<i class="fa fa-calendar"></i>\t\t\t\t\t\t</span>\t\t\t\t\t\t<input type="text" name="'+i+"["+(e-1)+"]["+o+']" class="form-control input-sm" autocomplete="off">\t\t\t\t\t</div>\t\t\t\t</td>':"datetime"==n?s+='<td data-field-type="datetime">\t\t\t\t\t<div class="input-group datetimepicker">\t\t\t\t\t\t<span class="input-group-addon">\t\t\t\t\t\t\t<i class="fa fa-calendar"></i>\t\t\t\t\t\t</span>\t\t\t\t\t\t<input type="text" name="'+i+"["+(e-1)+"]["+o+']" class="form-control input-sm" autocomplete="off">\t\t\t\t\t</div>\t\t\t\t</td>':"text"==n?s+=r&&c?'<td data-field-type="'+n+'"'+m+'>\t\t\t\t\t\t<input type="text" name="'+i+"["+(e-1)+"]["+o+']" \t\t\t\t\t\tclass="form-control input-sm" data-ac-module="'+r+'" data-ac-field="'+c+'" autocomplete="off"'+f+">\t\t\t\t\t</td>":'<td data-field-type="'+n+'"'+m+'>\t\t\t\t\t\t<input type="text" name="'+i+"["+(e-1)+"]["+o+']" \t\t\t\t\t\tclass="form-control input-sm" autocomplete="off"'+f+">\t\t\t\t\t</td>":"textarea"==n?s+='<td data-field-type="textarea"'+m+'>\t\t\t\t\t<textarea rows="5" cols="8" name="'+i+"["+(e-1)+"]["+o+']" \t\t\t\t\tclass="form-control input-sm" autocomplete="off"></textarea>\t\t\t\t</td>':"blank"==n&&(s+='<td data-field-type="blank"'+m+"></td>")}}),s+="</tr>",$(o).append(s),maintainIdx(o),enableAutocomplete(),setPickersInTable(i,t,l)}function maintainIdx(t){var e=1;$.each($(t).find("tr"),function(t,a){$(a).is(":visible")&&($(a).attr("idx",e),$(a).find("td:first").html(e),e++)})}function showEmptyRow(t){var e=$(t).find("thead > tr > th").length,a='<tr class="odd">\t\t<td valign="middle" align="center" colspan="'+e+'">Empty</td>\t</tr>';$(t).find("tbody").append(a)}function addNewRows(t,e){var a=$('table[data-table="'+t+'"]'),i=$(a).find("thead"),n=$(a).find("tbody"),o=[],d="";$(n).find("tr").hasClass("odd")&&$(n).empty();var l=$(n).find("tr").length;$.each(e,function(e,a){l&&(e=l),d+='<tr class="table_record">',$.each($(i).find("tr > th"),function(i,n){var l=$(n).data("field-type"),s=$(n).data("field-name"),r=$(n).data("ac-module"),c=$(n).data("ac-field"),f="yes"==$(n).data("readonly")?"readonly":"",m="yes"==$(n).data("hidden")?"style='display: none;'":"";if(o.push(l),a[s]&&"string"==typeof a[s]&&(a[s].isDate()||a[s].isDateTime())?a[s].split(" ").length>1?field_value=moment(a[s]).format("DD-MM-YYYY hh:mm A"):field_value=moment(a[s]).format("DD-MM-YYYY"):a[s]&&"string"==typeof a[s]&&a[s].isTime()?field_value=moment(a[s],["HH:mm:ss"]).format("HH:mm"):field_value=a[s]||"",$(n).hasClass("sr-no"))d+='<td class="text-center" style="vertical-align: middle;">'+(e+1)+"</td>";else if($(n).hasClass("remove"))d+='<td class="text-center" data-idx="'+(e+1)+'">\t\t\t\t\t<button type="button" class="btn btn-danger btn-xs remove-row">\t\t\t\t\t\t<i class="fa fa-times"></i>\t\t\t\t\t</button>\t\t\t\t</td>';else if($(n).hasClass("action")){if(a.id)var p="none";else var p="create";d+='<td class="action" style="display: none;">\t\t\t\t\t<input type="text" class="form-control input-sm" name="'+t+"["+e+'][action]" value="'+p+'">\t\t\t\t</td>'}else $(n).hasClass("row-id")?d+='<td class="row-id" style="display: none;">\t\t\t\t\t<input type="text" class="form-control input-sm" name="'+t+"["+e+'][id]" value="'+a.id+'">\t\t\t\t</td>':"link"==l?d+='<td data-field-type="link">\t\t\t\t\t\t<input type="text" class="form-control input-sm autocomplete" \t\t\t\t\t\tname="'+t+"["+e+"]["+s+']" \t\t\t\t\t\tautocomplete="off" data-ac-module="'+r+'" data-ac-field="'+c+'"'+f+' value="'+field_value+'">\t\t\t\t\t</td>':"image"==l?(d+='<td data-field-type="image">\t\t\t\t\t\t<div class="col-md-12 media">\t\t\t\t\t\t\t<div class="pull-left text-center avatar-box">',a[s]?d+='<img src="'+a[s]+'" alt="Image">':d+='<i class="fa fa-picture-o inline fa-2x avatar"></i>',d+='</div>\t\t\t\t\t\t\t<div class="media-body text-left">\t\t\t\t\t\t\t\t<label title="Upload image file" class="btn btn-primary btn-xs">\t\t\t\t\t\t\t\t\t<input type="file" accept="image/*" name="'+t+"["+e+"]["+s+']" class="hide">\t\t\t\t\t\t\t\t\tChange\t\t\t\t\t\t\t\t</label>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>'):"select"==l?(d+='<td data-field-type="select">\t\t\t\t\t\t<select class="form-control input-sm" name="'+t+"["+e+"]["+s+']">',$.each($(n).data("options").split(","),function(t,e){if(e=trim(e),e=e.split(":"),2==e.length)var i=e[1],n=e[0];else var i=e[0],n=e[0];i==a[s]?d+='<option value="'+i+'" default selected>'+n+"</option>":d+='<option value="'+i+'">'+n+"</option>"}),d+="</select></td>"):"checkbox"==l?d+='<td data-field-type="checkbox"'+m+' class="text-center" style="vertical-align: middle;">\t\t\t\t\t\t<input type="hidden" class="checkbox-value" name="'+t+"["+e+"]["+s+']" '+f+' value="'+(parseInt(field_value)?1:0)+'">\t\t\t\t\t\t<input type="checkbox" name="'+t+"["+e+"]["+s+']" '+f+(parseInt(field_value)?" checked":"")+">\t\t\t\t\t</td>":"date"==l?d+='<td data-field-type="date">\t\t\t\t\t\t<div class="input-group date">\t\t\t\t\t\t\t<span class="input-group-addon">\t\t\t\t\t\t\t\t<i class="fa fa-calendar"></i>\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t<input type="text" name="'+t+"["+e+"]["+s+']" class="form-control input-sm" autocomplete="off" value="'+field_value+'">\t\t\t\t\t\t</div>\t\t\t\t\t</td>':"datetime"==l?d+='<td data-field-type="datetime">\t\t\t\t\t\t<div class="input-group datetimepicker">\t\t\t\t\t\t\t<span class="input-group-addon">\t\t\t\t\t\t\t\t<i class="fa fa-calendar"></i>\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t<input type="text" name="'+t+"["+e+"]["+s+']" class="form-control input-sm" autocomplete="off" value="'+field_value+'">\t\t\t\t\t\t</div>\t\t\t\t\t</td>':"text"==l?d+=r&&c?'<td data-field-type="'+l+'"'+m+'>\t\t\t\t\t\t\t<input type="text" name="'+t+"["+e+"]["+s+']" \t\t\t\t\t\t\tclass="form-control input-sm" data-ac-module="'+r+'" data-ac-field="'+c+'" autocomplete="off"'+f+' value="'+field_value+'">\t\t\t\t\t\t</td>':'<td data-field-type="'+l+'"'+m+'>\t\t\t\t\t\t\t<input type="text" name="'+t+"["+e+"]["+s+']" \t\t\t\t\t\t\tclass="form-control input-sm" autocomplete="off"'+f+' value="'+field_value+'">\t\t\t\t\t\t</td>':"textarea"==l?d+='<td data-field-type="textarea"'+m+'>\t\t\t\t\t\t<textarea rows="5" cols="8" name="'+t+"["+e+"]["+s+']" \t\t\t\t\t\tclass="form-control" autocomplete="off">'+field_value+"</textarea>\t\t\t\t\t</td>":"blank"==l&&(d+='<td data-field-type="blank">'+field_value+"</td>")}),d+="</tr>",l&&l++}),$(n).append(d),enableAutocomplete(),setPickersInTable(t,a,o)}function setPickersInTable(t,e,a){a.contains("date")&&$.each($("table > tbody > tr").find(".date"),function(a,i){$(i).datetimepicker({icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-crosshairs",clear:"fa fa-trash",close:"fa fa-times"},format:"DD-MM-YYYY",allowInputToggle:!0}).on("dp.change",function(a){if(void 0!==origin.data[t])var n=origin.data[t].length;else var n=0;var o=$(e).find("tbody > tr").length;$.trim($("body").find('[name="id"]').val())&&n==o&&$(i).closest("tr").find("td.action > input").val("update"),"function"==typeof changeDoc&&changeDoc()})}),a.contains("datetime")&&$.each($("table > tbody > tr").find(".datetimepicker"),function(a,i){$(i).datetimepicker({icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-crosshairs",clear:"fa fa-trash",close:"fa fa-times"},format:"DD-MM-YYYY hh:mm A",allowInputToggle:!0}).on("dp.change",function(a){if(void 0!==origin.data[t])var n=origin.data[t].length;else var n=0;var o=$(e).find("tbody > tr").length;$.trim($("body").find('[name="id"]').val())&&n==o&&$(i).closest("tr").find("td.action > input").val("update"),"function"==typeof changeDoc&&changeDoc()})})}var mandatory_fields=getMandatoryFields();$(document).ready(function(){var t=!1;$("form#"+origin.slug).on("change input","input, select, textarea",function(){changeDoc()}),$("form#"+origin.slug).on("change","input[type='file']",function(){$(this).val()&&showImagePreview(this)}),$("#delete").on("click",function(){var t=app_route,e=t.split("/").pop(),a=t.replace("/"+e,"/delete/"+e),i='<span class="pull-right">\t\t\t<button type="button" class="btn btn-sm" data-dismiss="modal">No</button>\t\t\t<a class="btn btn-danger btn-sm" href="'+a+'" id="yes" name="yes">\t\t\t\tDelete\t\t\t</a>\t\t</span>';msgbox("Sure you want to delete this record permanently?",i)}),$("#delete").on("click",function(){var t=app_route,e=t.split("/").pop(),a=t.replace("/"+e,"/delete/"+e),i='<span class="pull-right">\t\t\t<button type="button" class="btn btn-sm" data-dismiss="modal">No</button>\t\t\t<a class="btn btn-danger btn-sm" href="'+a+'" id="yes" name="yes">\t\t\t\tDelete\t\t\t</a>\t\t</span>';msgbox("Sure you want to delete this record permanently?",i)}),$("#save_form").on("click",function(){$("#"+origin.slug).submit()}),setDocData(),initializeMandatoryFields(),enableAutocomplete(),$('[name="id"]').val()?origin.permissions.update||(t=!0):origin.permissions.create||(t=!0),"Settings"==origin.module&&(t=!1),t&&makeFieldsReadable(),$("form#"+origin.slug).submit(function(t){var e=!0;$.each(mandatory_fields,function(a,i){if(!trim($(i).val())){t.preventDefault(),e=!1;var n=$(i).attr("name");return $(i).closest(".table_record")&&n.match(/\[(.*?)\]/g)&&(n=n.match(/\[(.*?)\]/g).pop().replace("[","").replace("]","")),notify("Please Enter "+n.replace("_"," ").toProperCase(),"error"),$(i).focus(),!1}}),e&&($.each($("form#"+origin.slug).find("input[type='checkbox']"),function(t,e){this.checked?($(this).val("1"),$(this).closest(".checkbox-value").prop("disabled",!0)):$(this).val("0")}),$(".data-loader-full").show())})}),window.origin.make={button:function(t){var e=t.text,a=t.name;if(void 0!==t.class&&t.class)var i="btn "+t.class;else var i="btn btn-primary";var n=document.createElement("button");n.setAttribute("type","button"),n.setAttribute("name",a),n.setAttribute("id",a),n.setAttribute("class",i),void 0!==t.loading_text&&t.loading_text&&n.setAttribute("data-loading-text",t.loading_text),n.appendChild(document.createTextNode(e)),$(".ibox-tools").prepend(n),void 0!==t.on_click&&t.on_click&&$("#"+a).on("click",function(){t.on_click()})}},$(document).ready(function(){$(".new-row").on("click",function(){var t=$("#"+$(this).data("target"));addNewRow(t),$(t).find("tr:last > td:eq(3) > input").focus()}),$("table").on("click",".remove-row",function(){var t=$(this).closest("table"),e=($(t).attr("id"),$(t).find("tbody")),a=($(t).data("table"),$(this).closest(".table_record").find(".row-id"));a=$(a).find('input[name$="[id]"]'),$('[name="id"]').val()&&$(a).val()?($(this).closest("tr.table_record").find("td.action").find("input").val("delete"),$(this).closest("tr.table_record").hide()):$(this).closest("tr").remove(),$(e).find("tr:visible").length?maintainIdx(e):showEmptyRow(t),enableSaveButton()}),$("table").on("click",".table_record",function(){$(this).find("input").removeClass("simple-box")}),$("table > tbody > tr").on("change","input, select, textarea",function(){$('[name="id"]').val()&&$(this).closest("tr").find("td.action > input").val("update"),"checkbox"==$(this).attr("type")&&(this.checked?$(this).parent().find(".checkbox-value").val("1"):$(this).parent().find(".checkbox-value").val("0"))})});