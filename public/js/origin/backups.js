$(document).ready((function(){var e=1,a=!1;function t(e,t){a||$("body").find(".data-loader").show(),$.ajax({type:"GET",url:app_route+"?page="+e,dataType:"json",success:function(e){a=!1;var t=["name","date","size","type","download","delete"],n=e.backups.data,o=$("body").find(".backups-view"),d="";if(Object.keys(n).length>0)$.each(n,(function(e,a){d+='<tr class="clickable_row">                            <td class="text-center">'+(parseInt(e)+1)+"</td>",$.each(t,(function(e,t){var n=a[t];"download"==t?d+='<td data-field-name="'+t+'">                                    <a href="'+n+'" class="btn btn-success btn-xs" data-toggle="tooltip" data-placement="bottom" title="'+__("Download backup")+'">                                        <span class="d-none d-sm-none d-md-inline-block">'+__("Download")+'</span>                                        <span class="d-md-none d-lg-none d-xl-none"><i class="fas fa-download"></i></span>                                    </a>                                </td>':"delete"==t?d+='<td data-field-name="'+t+'">                                    <button class="btn btn-danger btn-xs delete-backup" data-toggle="tooltip" data-placement="bottom" title="'+__("Delete backup")+'" data-href="'+n+'">                                        <span class="d-none d-sm-none d-md-inline-block">'+__("Delete")+'</span>                                        <span class="d-md-none d-lg-none d-xl-none"><i class="fas fa-trash"></i></span>                                    </button>                                </td>':"type"==t?"Database"==n?d+='<td data-field-name="'+t+'">                                        <span class="indicator-pill indicator-info">'+__("Database")+"</span>                                    </td>":"Files"==n?d+='<td data-field-name="'+t+'">                                        <span class="indicator-pill indicator-pink">'+__("Files")+"</span>                                    </td>":"Database + Files"==n&&(d+='<td data-field-name="'+t+'">                                        <span class="indicator-pill indicator-purple">'+__("Database")+" + "+__("Files")+"</span>                                    </td>"):"date"==t?(n=moment(a.date).format("D MMM YYYY â€¢ hh:mm A"),d+='<td data-field-name="'+t+'">'+n+"</td>"):d+='<td data-field-name="'+t+'">'+n+"</td>"})),d+="</tr>"}));else{var s=$("body").find(".new-backup").clone().wrap("<div />").parent().html(),i=getAddNewRecord("Backups",s);d='<tr class="no-results">                        <td colspan="'+(t.length+1)+'" class="not-found">'+i+"</td>                    </tr>"}$(o).find(".list-view-items").empty().append(d),Object.keys(n).length>0?($("body").find(".list-header").show(),$("body").find(".list-actions").show(),$("body").find(".page-no").html(e.backups.current_page||"0"),$("body").find(".item-count").html(e.backups.total||"0"),$("body").find(".item-from").html(e.backups.from||"0"),$("body").find(".item-to").html(e.backups.to||"0"),$("body").find(".origin-pagination-content").empty().append(makePagination(e.backups))):($("body").find(".list-header").hide(),$("body").find(".list-actions").hide()),$("body").find(".data-loader").hide()},error:function(e){if(void 0!==JSON.parse(e.responseText).message)var a=JSON.parse(e.responseText).message;else a=__("Some error occured. Please try again");notify(a,"error"),$("body").find(".data-loader").hide()}})}t(e),$("body").on("click",".refresh-backups",(function(){t(e=1)})),$("body").on("click",".delete-backup",(function(){var e=$(this).data("href"),a=__("Delete"),t="<p>"+__("Sure you want to delete this backup permanently")+"?</p>",n='<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">'+__("No")+'</button>            <button type="button" class="btn bg-gradient-danger btn-sm confirm-delete-backup" data-href="'+e+'">'+__("Yes")+"</button>";msgbox(t,n,a)})),$("body").on("click",".confirm-delete-backup",(function(){var n=$(this).data("href");$.ajax({type:"POST",url:n,dataType:"json",success:function(n){$("body").find("#message-box").modal("hide"),n.success?(a=!0,t(e)):notify(n.msg,"error")},error:function(e){if(void 0!==JSON.parse(e.responseText).message)var a=JSON.parse(e.responseText).message;else a=__("Some error occured. Please try again");notify(a,"error"),$("body").find("#message-box").modal("hide")}})})),$("body").on("click",".create-backup",(function(a){a.preventDefault();var n=$(this).data("href");$("body").find(".data-loader-full").show(),$.ajax({type:"POST",url:n,dataType:"json",success:function(a){$("body").find(".data-loader-full").hide(),a.success?(notify(a.msg,"info"),t(e)):notify(a.msg,"error")},error:function(e){if(void 0!==JSON.parse(e.responseText).message)var a=JSON.parse(e.responseText).message;else a=__("Some error occured. Please try again");notify(a,"error"),$("body").find(".data-loader-full").hide()}})})),$("body").on("click",".origin-pagination a",(function(a){a.preventDefault(),"#"!=$(this).attr("href")&&$(this).attr("href").indexOf("page=")>=0&&t(e=$(this).attr("href").split("page=")[1])})),$(window).on("hashchange",(function(){if(window.location.hash){var e=window.location.hash.replace("#","");if(e==Number.NaN||e<=0)return!1;t(e)}}))}));
