var mandatory_fields=getMandatoryFields();function changeDoc(){origin.changed=!0,initializeMandatoryFields(),removeMandatoryHighlight(mandatory_fields),enableSaveButton()}function initializeMandatoryFields(){highlightMandatoryFields(mandatory_fields=getMandatoryFields())}function getMandatoryFields(){var t=[];return $form_elements=$("form").find("input, select, textarea"),$.each($form_elements,function(e,a){"yes"==$(this).data("mandatory")&&t.push($(a)[0])}),t}function highlightMandatoryFields(t){t||(t=getMandatoryFields()),$.each(t,function(t,e){""==trim($(this).val())&&($(e).closest(".table_record").length||$(e).closest(".form-group").addClass("is-invalid"),$(e).addClass("is-invalid"))})}function removeMandatoryHighlight(t){t||(t=getMandatoryFields()),$.each(t,function(){$parent_div=$(this).closest(".form-group"),trim($(this).val())?($(this).closest(".table_record").length||$($parent_div).removeClass("is-invalid"),$(this).removeClass("is-invalid")):($(this).closest(".table_record").length||$($parent_div).addClass("is-invalid"),$(this).addClass("is-invalid"))})}function makeFieldsReadable(){$form_elements=$("form#"+origin.slug).find("input, select, textarea"),$.each($form_elements,function(t,e){var a=$(e).attr("type"),i=!1;if(!["hidden","file"].contains(a)){var o="";if("checkbox"==a)o=$(e).is(":checked")?'<i class="far fa-check-square fa-lg"></i>':'<i class="far fa-square fa-lg"></i>';else{var n=$(e).val();if("active"==$(e).attr("name")&&(n=parseInt(n)?"Yes":"No"),n=n||"",$(e).closest(".form-group").find(".input-group").length){i=!0;var s=$(e).closest(".form-group").find(".input-group");o='<p class="form-control-static origin-static">'+(n=$(s).find(".input-group-append").length?'<span class="mr-2">'+n+"</span>"+trim($(s).find(".input-group-text").html()):trim($(s).find(".input-group-text").html())+'<span class="ml-2">'+n+"</span>")+"</p>"}else o='<p class="form-control-static origin-static">'+n+"</p>"}i?$(o).insertBefore($(e).closest(".form-group").find(".input-group")):"checkbox"==a?$(o).insertBefore($(e).closest(".custom-checkbox")):$(o).insertBefore($(e))}"file"==$(e).attr("type")&&$(e).closest(".btn").remove(),i?$(e).closest(".form-group").find(".input-group").remove():"checkbox"==a?$(e).closest(".custom-checkbox").remove():$(e).remove()}),$.each($("table"),function(t,e){$(e).find("th.remove").remove(),$(e).find(".remove-row").closest("td").remove(),$(e).find(".new-row").closest("tr").remove()})}function enableSaveButton(){form_changed=!0,$("body").find("#save_form").removeClass("disabled"),$("body").find("#save_form").prop("disabled",!1),$("body").find("#form-stats > i").removeClass("text-green").addClass("text-warning"),$("body").find("#form-status").html(__("Not Saved"))}function showImagePreview(t){if(t.files&&t.files[0]){var e=new FileReader;e.onload=function(e){var a='<img src="'+e.target.result+'">';$(t).closest(".media").find(".avatar-box").empty().append(a)},e.readAsDataURL(t.files[0])}}function setDocData(){void 0!==origin.data&&origin.data&&($.each(origin.data,function(t,e){$.each(e,function(a,i){if("string"==typeof i||"number"==typeof i){var o=$("form#"+origin.slug).find('[name="'+a+'"]');$(o).length&&"file"!=$(o).attr("type")&&("string"==typeof i&&(i.isDate()||i.isDateTime()||i.isTime())&&($(o).attr("data-field-value",i),i=i.isDate()?moment.utc(i).tz(origin.time_zone).format("DD-MM-YYYY"):i.isDateTime()?moment.utc(i).tz(origin.time_zone).format("DD-MM-YYYY hh:mm A"):moment.utc("0001-01-01 "+column_value).tz(origin.time_zone).format("hh:mm A")),$(o).val(i))}else if("object"==typeof i&&i)return addNewRows(t,e),!1})}),$("form#"+origin.slug).find(".text-editor, .text-editor-advanced").each(function(t,e){$(e).trumbowyg("html",$(e).val())}),origin.permissions.update||($("body").find(".text-editor, .text-editor-advanced").trumbowyg("disable"),$("body").find(".text-editor, .text-editor-advanced").remove()))}function addFormStatic(t,e){var a='<div class="col-md-3"><span class="control-label">'+t+"</span>: "+e+"</div>";if($("body").find(".form-statics").length){var i=$("body").find(".form-statics");$(i).find(".static-list").append(a)}else{i='<div class="card form-section elevation-2">            <div class="card-header form-statics">                <div class="row static-list">'+a+"</div>            </div>        </div>";$("body").find(".form-section").first().before(i)}}function addNewRow(t,e,a){$(t).find("thead");var i=$(t).find("tbody");$(i).find("tr").hasClass("odd")&&$(i).empty(),addRow(t,e||$(i).find("tr").length+1,a)}function addRow(t,e,a){var i=$(t).data("table"),o=$(t).find("thead"),n=$(t).find("tbody"),s=a||"create",l=[],d='<tr class="table_record">';$.each($(o).find("tr > th"),function(t,a){if($(a).hasClass("sr-no")&&0==t)d+='<td class="text-center" style="vertical-align: middle;"></td>';else if($(a).hasClass("remove"))d+='<td class="text-center" data-idx="'+e+'" style="vertical-align: middle;">                <button type="button" class="btn btn-danger btn-xs remove-row">                    <i class="fas fa-times p-1"></i>                </button>            </td>';else if($(a).hasClass("action"))d+='<td class="action" style="display: none;">                <input type="text" class="form-control form-control-sm" name="'+i+"["+(e-1)+'][action]" value="'+s+'">            </td>',$(this).find('input[name="'+i+"["+(e-1)+'][action]"]').val(s);else if($(a).hasClass("row-id"))d+='<td class="row-id" style="display: none;">                <input type="text" class="form-control form-control-sm" name="'+i+"["+(e-1)+'][id]">            </td>';else{var o=$(a).data("field-type"),n=$(a).data("field-name"),c=$(a).data("ac-module"),r=$(a).data("ac-field"),f="yes"==$(a).data("readonly")?"readonly":"",m="yes"==$(a).data("hidden")?"style='display: none;'":"";l.push(o),"link"==o?d+='<td data-field-type="link">                    <input type="text" class="form-control form-control-sm autocomplete"                     name="'+i+"["+(e-1)+"]["+n+']"                     autocomplete="off" data-ac-module="'+c+'" data-ac-field="'+r+'"'+f+">                </td>":"image"==o?d+='<td data-field-type="image">                    <div class="col-md-12 media">                        <div class="pull-left text-center avatar-box">                            <i class="fas fa-image fa-2x avatar"></i>                        </div>                        <div class="media-body text-left">                            <label title="Upload image file" class="btn bg-gradient-secondary btn-xs ml-3 text-xs">                                <input type="file" accept="image/*" name="'+i+"["+(e-1)+"]["+n+']" class="d-none">                                '+__("Change")+"                            </label>                        </div>                    </div>                </td>":"select"==o?(d+='<td data-field-type="select">                    <select class="custom-select custom-select-sm" name="'+i+"["+(e-1)+"]["+n+']">',$.each($(a).data("options").split(","),function(t,e){if(2==(e=(e=trim(e)).split(":")).length)var a=e[1],i=e[0];else a=e[0],i=e[0];d+='<option value="'+a+'">'+i+"</option>"}),d+="</select></td>"):"checkbox"==o?d+='<td data-field-type="checkbox"'+m+' class="text-center" style="vertical-align: middle;">                    <div class="custom-control custom-checkbox text-center">                        <input type="hidden" class="checkbox-value" name="'+i+"["+(e-1)+"]["+n+']" value="0">                        <input type="checkbox" name="'+i+"["+(e-1)+"]["+n+']" id="check-'+(e-1)+'" class="custom-control-input" '+f+'>                        <label class="custom-control-label" for="check-'+(e-1)+'"></label>                    </div>                </td>':"date"==o?d+='<td data-field-type="date">                    <div class="input-group">                        <span class="input-group-prepend">                            <span class="input-group-text">                                <i class="fas fa-calendar-alt fa-sm"></i>                            </span>                        </span>                        <input type="text" name="'+i+"["+(e-1)+"]["+n+']" class="form-control form-control-sm datepicker pl-0" autocomplete="off">                    </div>                </td>':"time"==o?d+='<td data-field-type="time">                    <div class="input-group">                        <span class="input-group-prepend">                            <span class="input-group-text">                                <i class="fas fa-clock fa-sm"></i>                            </span>                        </span>                        <input type="text" name="'+i+"["+(e-1)+"]["+n+']" class="form-control form-control-sm timepicker pl-0" autocomplete="off">                    </div>                </td>':"datetime"==o?d+='<td data-field-type="datetime">                    <div class="input-group">                        <span class="input-group-prepend">                            <span class="input-group-text">                                <i class="fas fa-calendar-alt fa-sm"></i>                            </span>                        </span>                        <input type="text" name="'+i+"["+(e-1)+"]["+n+']" class="form-control form-control-sm datetimepicker pl-0" autocomplete="off">                    </div>                </td>':"text"==o?d+=c&&r?'<td data-field-type="'+o+'"'+m+'>                        <input type="text" name="'+i+"["+(e-1)+"]["+n+']"                         class="form-control form-control-sm" data-ac-module="'+c+'" data-ac-field="'+r+'" autocomplete="off"'+f+">                    </td>":'<td data-field-type="'+o+'"'+m+'>                        <input type="text" name="'+i+"["+(e-1)+"]["+n+']"                         class="form-control form-control-sm" autocomplete="off"'+f+">                    </td>":"textarea"==o?d+='<td data-field-type="textarea"'+m+'>                    <textarea rows="5" cols="8" name="'+i+"["+(e-1)+"]["+n+']"                     class="form-control form-control-sm" autocomplete="off"></textarea>                </td>':"blank"==o&&(d+='<td data-field-type="blank" data-field-name="'+n+'"'+m+"></td>")}}),d+="</tr>",$(n).append(d),maintainIdx(n),enableAutocomplete(),setPickersInTable(i,t,l)}function maintainIdx(t){var e=1;$.each($(t).find("tr"),function(t,a){$(a).is(":visible")&&($(a).attr("idx",e),$(a).find("td:first").html(e),e++)})}function showEmptyRow(t){var e='<tr class="odd">        <td valign="middle" align="center" colspan="'+$(t).find("thead > tr > th").length+'">Empty</td>    </tr>';$(t).find("tbody").append(e)}function addNewRows(t,e){var a=$('table[data-table="'+t+'"]'),i=$(a).find("thead"),o=$(a).find("tbody"),n=[],s="";$(o).find("tr").hasClass("odd")&&$(o).empty();var l=$(o).find("tr").length;$.each(e,function(e,a){l&&(e=l),s+='<tr class="table_record">',$.each($(i).find("tr > th"),function(i,o){var l=$(o).data("field-type"),d=$(o).data("field-name"),c=$(o).data("ac-module"),r=$(o).data("ac-field"),f="yes"==$(o).data("readonly")?"readonly":"",m="yes"==$(o).data("hidden")?"style='display: none;'":"";if(n.push(l),a[d]&&"string"==typeof a[d]&&(a[d].isDate()||a[d].isDateTime())?a[d].split(" ").length>1?field_value=moment.utc(a[d]).tz(origin.time_zone).format("DD-MM-YYYY hh:mm A"):field_value=moment.utc(a[d]).tz(origin.time_zone).format("DD-MM-YYYY"):a[d]&&"string"==typeof a[d]&&a[d].isTime()?field_value=moment.utc(a[d],["HH:mm:ss"]).tz(origin.time_zone).format("HH:mm"):field_value=a[d]||"",$(o).hasClass("sr-no"))s+='<td class="text-center" style="vertical-align: middle;">'+(e+1)+"</td>";else if($(o).hasClass("remove"))s+='<td class="text-center" data-idx="'+(e+1)+'" style="vertical-align: middle;">                    <button type="button" class="btn btn-danger btn-xs remove-row">                        <i class="fas fa-times p-1"></i>                    </button>                </td>';else if($(o).hasClass("action")){if(a.id)var p="none";else p="create";s+='<td class="action" style="display: none;">                    <input type="text" class="form-control form-control-sm" name="'+t+"["+e+'][action]" value="'+p+'">                </td>'}else $(o).hasClass("row-id")?s+='<td class="row-id" style="display: none;">                    <input type="text" class="form-control form-control-sm" name="'+t+"["+e+'][id]" value="'+a.id+'">                </td>':"link"==l?s+='<td data-field-type="link">                        <input type="text" class="form-control form-control-sm autocomplete"                         name="'+t+"["+e+"]["+d+']"                         autocomplete="off" data-ac-module="'+c+'" data-ac-field="'+r+'"'+f+' value="'+field_value+'">                    </td>':"image"==l?(s+='<td data-field-type="image">                        <div class="col-md-12 media">                            <div class="pull-left text-center avatar-box">',a[d]?s+='<img src="'+getImage(a[d],"100","100")+'" class="fancyimg" data-big="'+getImage(a[d])+'" alt="Image">':s+='<i class="fas fa-image fa-2x avatar"></i>',s+='</div>                            <div class="media-body text-left">                                <label title="Upload image file" class="btn bg-gradient-secondary btn-xs ml-3 text-xs">                                    <input type="file" accept="image/*" name="'+t+"["+e+"]["+d+']" class="d-none">                                    '+__("Change")+"                                </label>                            </div>                        </div>                    </td>"):"select"==l?(s+='<td data-field-type="select">                        <select class="custom-select custom-select-sm" name="'+t+"["+e+"]["+d+']">',$.each($(o).data("options").split(","),function(t,e){if(2==(e=(e=trim(e)).split(":")).length)var i=e[1],o=e[0];else i=e[0],o=e[0];i==a[d]?s+='<option value="'+i+'" default selected>'+o+"</option>":s+='<option value="'+i+'">'+o+"</option>"}),s+="</select></td>"):"checkbox"==l?s+='<td data-field-type="checkbox"'+m+' class="text-center" style="vertical-align: middle;">                        <div class="custom-control custom-checkbox text-center">                            <input type="hidden" class="checkbox-value" name="'+t+"["+e+"]["+d+']" '+f+' value="'+(parseInt(field_value)?1:0)+'">                            <input type="checkbox" name="'+t+"["+e+"]["+d+']" id="check-'+e+'" class="custom-control-input" '+f+(parseInt(field_value)?" checked":"")+'>                            <label class="custom-control-label" for="check-'+e+'"></label>                        </div>                    </td>':"date"==l?s+='<td data-field-type="date">                        <div class="input-group">                            <span class="input-group-prepend">                                <span class="input-group-text">                                    <i class="fas fa-calendar-alt fa-sm"></i>                                </span>                            </span>                            <input type="text" name="'+t+"["+e+"]["+d+']" class="form-control form-control-sm datepicker pl-0" autocomplete="off" value="'+field_value+'">                        </div>                    </td>':"time"==l?s+='<td data-field-type="time">                        <div class="input-group">                            <span class="input-group-prepend">                                <span class="input-group-text">                                    <i class="fas fa-clock fa-sm"></i>                                </span>                            </span>                            <input type="text" name="'+t+"["+e+"]["+d+']" class="form-control form-control-sm timepicker pl-0" autocomplete="off" value="'+field_value+'">                        </div>                    </td>':"datetime"==l?s+='<td data-field-type="datetime">                        <div class="input-group">                            <span class="input-group-prepend">                                <span class="input-group-text">                                    <i class="fas fa-calendar-alt fa-sm"></i>                                </span>                            </span>                            <input type="text" name="'+t+"["+e+"]["+d+']" class="form-control form-control-sm datetimepicker pl-0" autocomplete="off" value="'+field_value+'">                        </div>                    </td>':"text"==l?s+=c&&r?'<td data-field-type="'+l+'"'+m+'>                            <input type="text" name="'+t+"["+e+"]["+d+']"                             class="form-control form-control-sm" data-ac-module="'+c+'" data-ac-field="'+r+'" autocomplete="off"'+f+' value="'+field_value+'">                        </td>':'<td data-field-type="'+l+'"'+m+'>                            <input type="text" name="'+t+"["+e+"]["+d+']"                             class="form-control form-control-sm" autocomplete="off"'+f+' value="'+field_value+'">                        </td>':"textarea"==l?s+='<td data-field-type="textarea"'+m+'>                        <textarea rows="5" cols="8" name="'+t+"["+e+"]["+d+']"                         class="form-control" autocomplete="off">'+field_value+"</textarea>                    </td>":"blank"==l&&(s+='<td data-field-type="blank" data-field-name="'+d+'"'+m+">"+field_value+"</td>")}),s+="</tr>",l&&l++}),$(o).append(s),enableAutocomplete(),setPickersInTable(t,a,n),enableFancyBox()}function setPickersInTable(t,e,a){a.contains("date")&&$.each($("table > tbody > tr").find(".datepicker"),function(a,i){$(i).datetimepicker({icons:{time:"fas fa-clock",date:"fas fa-calendar-alt",up:"fas fa-chevron-up",down:"fas fa-chevron-down",previous:"fas fa-chevron-left",next:"fas fa-chevron-right",today:"fas fa-crosshairs",clear:"fas fa-trash",close:"fas fa-times"},format:"DD-MM-YYYY",allowInputToggle:!0}).on("dp.change",function(a){if(void 0!==origin.data[t])var o=origin.data[t].length;else o=0;var n=$(e).find("tbody > tr").length;trim($("body").find('[name="id"]').val())&&o==n&&$(i).closest("tr").find("td.action > input").val("update"),"function"==typeof changeDoc&&changeDoc()})}),a.contains("time")&&$.each($("table > tbody > tr").find(".timepicker"),function(a,i){$(i).datetimepicker({icons:{up:"fas fa-chevron-up",down:"fas fa-chevron-down"},format:"hh:mm A",allowInputToggle:!0}).on("dp.change",function(a){if(void 0!==origin.data[t])var o=origin.data[t].length;else o=0;var n=$(e).find("tbody > tr").length;trim($("body").find('[name="id"]').val())&&o==n&&$(i).closest("tr").find("td.action > input").val("update"),"function"==typeof changeDoc&&changeDoc()})}),a.contains("datetime")&&$.each($("table > tbody > tr").find(".datetimepicker"),function(a,i){$(i).datetimepicker({icons:{time:"fas fa-clock",date:"fas fa-calendar-alt",up:"fas fa-chevron-up",down:"fas fa-chevron-down",previous:"fas fa-chevron-left",next:"fas fa-chevron-right",today:"fas fa-crosshairs",clear:"fas fa-trash",close:"fas fa-times"},format:"DD-MM-YYYY hh:mm A",allowInputToggle:!0}).on("dp.change",function(a){if(void 0!==origin.data[t])var o=origin.data[t].length;else o=0;var n=$(e).find("tbody > tr").length;trim($("body").find('[name="id"]').val())&&o==n&&$(i).closest("tr").find("td.action > input").val("update"),"function"==typeof changeDoc&&changeDoc()})})}$(document).ready(function(){var t=!1;$("form#"+origin.slug).on("change input","input, select, textarea",function(){changeDoc()}),$("form#"+origin.slug).on("change","input[type='file']",function(){$(this).val()&&showImagePreview(this)}),$("body").on("click","#delete",function(){var t=app_route,e=t.split("/").pop(),a=t.replace("/"+e,"/delete/"+e),i='<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">'+__("No")+'</button>            <a class="btn btn-danger btn-sm" href="'+a+'">                '+__("Delete")+"            </a>";msgbox(__("Sure you want to delete this record permanently")+"?",i)}),$("body").on("click","#save_form",function(){$("body").find("#"+origin.slug).submit()}),setDocData(),initializeMandatoryFields(),enableAutocomplete(),$("body").find('[name="id"]').val()?origin.permissions.update||(t=!0):origin.permissions.create||(t=!0),"Settings"==origin.module&&(t=!1),t&&makeFieldsReadable(),$("form#"+origin.slug).submit(function(t){var e=!0;$.each(mandatory_fields,function(a,i){if(!trim($(i).val())){t.preventDefault(),e=!1;var o=trim($(i).closest(".form-group").find(".control-label").html());if($(i).closest(".table_record").length){var n=$(i).closest(".table_record"),s=$(n).index();o=$(n).closest(".child-table").find("thead > tr > th").eq(s).html()}return o=o.replace(' <span class="text-danger">*</span>',""),notify(__("Please enter")+" "+o,"error"),$(i).focus(),!1}}),e&&($.each($("form#"+origin.slug).find("input[type='checkbox']"),function(t,e){this.checked?($(this).val("1"),$(this).closest(".checkbox-value").prop("disabled",!0)):$(this).val("0")}),$("body").find(".data-loader-full").show())})}),window.origin.make={button:function(t){var e=t.text,a=t.name;if(void 0!==t.class&&t.class)var i="btn "+t.class;else i="btn btn-primary";var o=document.createElement("button");o.setAttribute("type","button"),o.setAttribute("name",a),o.setAttribute("id",a),o.setAttribute("class",i),o.appendChild(document.createTextNode(e)),$("body").find(".ibox-tools").prepend(o),void 0!==t.on_click&&t.on_click&&$("#"+a).on("click",function(){t.on_click()})}},$(document).ready(function(){$("body").on("click",".new-row",function(){var t=$("#"+$(this).data("target"));addNewRow(t),$(t).find("tr:last > td:eq(3) > input").focus()}),$("table").on("click",".remove-row",function(){var t=$(this).closest("table"),e=($(t).attr("id"),$(t).find("tbody")),a=($(t).data("table"),$(this).closest(".table_record").find(".row-id"));a=$(a).find('input[name$="[id]"]'),$("body").find('[name="id"]').val()&&$(a).val()?($(this).closest("tr.table_record").find("td.action").find("input").val("delete"),$(this).closest("tr.table_record").hide()):$(this).closest("tr").remove(),$(e).find("tr:visible").length?maintainIdx(e):showEmptyRow(t),enableSaveButton()}),$("table").on("click",".table_record",function(){$(this).find("input").removeClass("simple-box")}),$("table > tbody > tr").on("change","input, select, textarea",function(){$('[name="id"]').val()&&$(this).closest("tr").find("td.action > input").val("update"),"checkbox"==$(this).attr("type")&&(this.checked?$(this).parent().find(".checkbox-value").val("1"):$(this).parent().find(".checkbox-value").val("0"))})});
